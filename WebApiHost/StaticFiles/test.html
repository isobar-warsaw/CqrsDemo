<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>CQRS CONNECTOR TEST</title>
	<style>
		span {
			padding-right: 12px
		}

		form {
			border: 1px solid blue;
			margin-top: 30px
		}
	</style>
</head>
<body>
	<p>This is test</p>
	<p id="clock"></p>
	<div>
		<span>{ "TestQuery": { "Value": 2 } }</span><span>returned</span><span id="TestQueryReturnedValue">...</span>(should be 4)<span>
		</span>
	</div>
	<input type="file" id="FileSelector" name="file" multiple>
	<button id="SendFile">SEND</button>
<script type="text/javascript">
	class TestQuery {
		constructor(value) {
			this.Value = value;
		}
	}

	class FileCommand {
		constructor(saveAs) {
			this.SaveAs = saveAs;
		}
	}

	const message = new TestQuery(2);

	const sendButton = document.querySelector("#SendFile");
	sendButton.addEventListener('click',
		async () => {
			console.log("Sending...");
			const fileInput = document.querySelector("#FileSelector");
			const file = fileInput.files[0];

			const command = new FileCommand("buzz.txt");

			const options = {
				method: 'POST',
				body: file,
				headers: {
					"Message": JSON.stringify({ [FileCommand.name]: command })
				}
			}
			const response = await fetch('http://localhost:53151/File', options);
			console.log(response);
		});

	
	(async (g) => {
		try {
				
			console.log(message.name);
			const requestBody = JSON.stringify({ [TestQuery.name]: message });
			console.log("Sending: ", requestBody);
			const response = await fetch('http://localhost:53151/CqrsBus', {
				method: 'POST',
				headers: {
					"Content-Type": "application/json"
				},
				body: requestBody
			});
			const data = await response.text(); // await response.json();
			console.log("Response:", data);
			document.querySelector("#TestQueryReturnedValue").innerHTML = data;
		}
		catch (error) {
			console.log("Error:", error);
		}
	})();

	setInterval(() => document.querySelector("#clock").innerHTML = new Date().toLocaleTimeString(), 1000);
</script>
</body>

</html>